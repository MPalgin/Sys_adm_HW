### Задание 1

```
select ((sum(index_length)/sum(data_length)) * 100)  from INFORMATION_SCHEMA.tables where table_schema = 'sakila'
```
### Задание 2:

Узкие места OVER (PARTITION BY c.customer_id,f.title ), который сильной замедляет обработку запроса, f.title из таблицы film, который не используется. Сложная обработка фильтра без созданых индексов.
Полученный запрос:

```
create index payment_info on payment(payment_date);
create index rental_info on rental(rental_date, customer_id, inventory_id);
create index customer_data on customer(customer_id);
create index inventory_data on inventory(inventory_id);

select distinct concat(c.last_name, ' ', c.first_name), sum(p.amount) 
from payment p, rental r, customer c, inventory i
where date(p.payment_date) = '2005-07-30' and p.payment_date = r.rental_date and r.customer_id = c.customer_id and i.inventory_id = r.inventory_id
group by c.customer_id;

```
```
-> Limit: 200 row(s)  (actual time=71..71 rows=200 loops=1)
    -> Sort with duplicate removal: `concat(c.last_name, ' ', c.first_name)`, `sum(p.amount)`  (actual time=71..71 rows=200 loops=1)
        -> Table scan on <temporary>  (actual time=70.8..70.8 rows=391 loops=1)
            -> Aggregate using temporary table  (actual time=70.8..70.8 rows=391 loops=1)
                -> Nested loop inner join  (cost=16489 rows=16091) (actual time=0.399..70.1 rows=642 loops=1)
                    -> Nested loop inner join  (cost=10857 rows=15423) (actual time=0.0919..38.5 rows=16044 loops=1)
                        -> Nested loop inner join  (cost=5459 rows=15423) (actual time=0.0881..21.5 rows=16044 loops=1)
                            -> Covering index scan on c using full_name  (cost=61.2 rows=599) (actual time=0.0422..0.283 rows=599 loops=1)
                            -> Index lookup on r using idx_fk_customer_id (customer_id=c.customer_id)  (cost=6.44 rows=25.7) (actual time=0.0274..0.0341 rows=26.8 loops=599)
                        -> Single-row covering index lookup on i using PRIMARY (inventory_id=r.inventory_id)  (cost=0.25 rows=1) (actual time=895e-6..920e-6 rows=1 loops=16044)
                    -> Index lookup on p using payment_info (payment_date=r.rental_date), with index condition: (cast(p.payment_date as date) = '2005-07-30')  (cost=0.261 rows=1.04) (actual time=0.00185..0.00187 rows=0.04 loops=16044)
```
